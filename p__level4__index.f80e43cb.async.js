"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[682],{44170:function(fe,_,v){v.r(_),v.d(_,{default:function(){return ve}});var te=v(42122),I=v.n(te),ne=v(861),k=v.n(ne),ae=v(27424),m=v.n(ae),u=v(67294),re=v(41777),ue=v(98320),se=v(74704),ie=v.n(se),ce=v(38416),T=v.n(ce),a=v(85893),oe=T()(T()(T()(T()(T()(T()(T()({\u4E00:1,\u4E8C:2,\u4E09:3,\u4EBA:2,\u5927:3,\u5C0F:3,\u4E2D:4,\u56FD:8,\u6211:7,\u662F:9,\u7231:10},"\u4E2D",4),"\u534E",6),"\u4EBA",2),"\u6C11",5),"\u5171",6),"\u548C",8),"\u56FD",8);function le(A){var x=A.targetCharacter,C=A.onCharacterMatch,L=A.width,V=L===void 0?300:L,M=A.height,y=M===void 0?300:M,K=A.showOutline,R=K===void 0?!0:K,N=(0,u.useRef)(null),p=(0,u.useRef)(null),Z=(0,u.useState)([]),Y=m()(Z,2),S=Y[0],E=Y[1],w=(0,u.useState)(!1),X=m()(w,2),B=X[0],P=X[1],z=(0,u.useState)([]),H=m()(z,2),d=H[0],D=H[1];(0,u.useEffect)(function(){if(!(!p.current||!R||!x)){var r=p.current,e=r.getContext("2d");e&&(e.clearRect(0,0,r.width,r.height),e.globalAlpha=.3,e.fillStyle="#ddd",e.font="bold 120px serif",e.textAlign="center",e.textBaseline="middle",e.fillText(x,r.width/2,r.height/2),e.globalAlpha=1)}},[x,R]);var b=(0,u.useCallback)(function(){E([]),D([]),F()},[]),Q=(0,u.useCallback)(function(){S.length!==0&&(E(function(r){return r.slice(0,-1)}),F())},[S]),F=(0,u.useCallback)(function(){var r=N.current;if(r){var e=r.getContext("2d");if(e&&(e.clearRect(0,0,r.width,r.height),e.strokeStyle="#000",e.lineWidth=3,e.lineCap="round",e.lineJoin="round",S.forEach(function(n){if(!(n.points.length<2)){e.beginPath(),e.moveTo(n.points[0].x,n.points[0].y);for(var t=1;t<n.points.length;t++)e.lineTo(n.points[t].x,n.points[t].y);e.stroke()}}),d.length>1)){e.beginPath(),e.moveTo(d[0].x,d[0].y);for(var s=1;s<d.length;s++)e.lineTo(d[s].x,d[s].y);e.stroke()}}},[S,d]),G=(0,u.useCallback)(function(r){r.preventDefault();var e=N.current;if(e){var s=e.getBoundingClientRect(),n="touches"in r?r.touches[0].clientX:r.clientX,t="touches"in r?r.touches[0].clientY:r.clientY,c=n-s.left,i=t-s.top;P(!0),D([{x:c,y:i}])}},[]),$=(0,u.useCallback)(function(r){if(r.preventDefault(),!!B){var e=N.current;if(e){var s=e.getBoundingClientRect(),n="touches"in r?r.touches[0].clientX:r.clientX,t="touches"in r?r.touches[0].clientY:r.clientY,c=n-s.left,i=t-s.top;D(function(o){return[].concat(k()(o),[{x:c,y:i}])})}}},[B]),O=(0,u.useCallback)(function(r){r.preventDefault(),B&&(P(!1),d.length>0&&(E(function(e){return[].concat(k()(e),[{points:d}])}),D([])))},[B,d]),U=function(e,s){if(!e||s.length===0)return!1;var n=oe[e]||Math.ceil(e.length*2),t=s.length,c=Math.max(1,n-2),i=n+2;if(t<c||t>i)return!1;var o=0,h=ie()(s),g;try{for(h.s();!(g=h.n()).done;){var l=g.value;f(l)&&o++}}catch(j){h.e(j)}finally{h.f()}return o>=t*.7},f=function(e){if(e.points.length<3)return!1;for(var s=0,n=1;n<e.points.length;n++){var t=e.points[n].x-e.points[n-1].x,c=e.points[n].y-e.points[n-1].y;s+=Math.sqrt(t*t+c*c)}return s>=15},W=(0,u.useCallback)(function(){if(!(S.length===0||!x))try{var r=U(x,S);r&&(b(),C(x),q())}catch(e){console.error("\u8BC6\u522B\u5931\u8D25:",e)}},[S,x,C,b]),q=(0,u.useCallback)(function(){try{var r=new Audio("/mp3/success.mp3");r.play().catch(function(){var e=new(window.AudioContext||window.webkitAudioContext),s=e.createOscillator(),n=e.createGain();s.connect(n),n.connect(e.destination),s.frequency.setValueAtTime(800,e.currentTime),s.frequency.exponentialRampToValueAtTime(1200,e.currentTime+.3),n.gain.setValueAtTime(.2,e.currentTime),n.gain.exponentialRampToValueAtTime(.01,e.currentTime+.3),s.start(e.currentTime),s.stop(e.currentTime+.3)})}catch(e){console.error("\u64AD\u653E\u97F3\u6548\u5931\u8D25:",e)}},[]);return(0,u.useEffect)(function(){F()},[S,d,F]),(0,a.jsxs)("div",{className:"handwriting-canvas",children:[(0,a.jsxs)("div",{className:"canvas-container",children:[R&&(0,a.jsx)("canvas",{ref:p,width:V,height:y,className:"outline-canvas",style:{position:"absolute",top:0,left:0,pointerEvents:"none"}}),(0,a.jsx)("canvas",{ref:N,width:V,height:y,className:"handwriting-canvas-element",onMouseDown:G,onMouseMove:$,onMouseUp:O,onMouseLeave:O,onTouchStart:G,onTouchMove:$,onTouchEnd:O,style:{touchAction:"none",position:"relative",zIndex:1}})]}),(0,a.jsxs)("div",{className:"handwriting-controls",children:[(0,a.jsx)("button",{onClick:Q,className:"control-btn undo-btn",children:"\u56DE\u9000\u4E00\u6B65"}),(0,a.jsx)("button",{onClick:b,className:"control-btn clear-btn",children:"\u6E05\u9664\u5168\u90E8"}),(0,a.jsx)("button",{onClick:W,className:"control-btn confirm-btn",children:"\u786E\u8BA4\u8BC6\u522B"})]}),(0,a.jsxs)("div",{className:"target-character",children:["\u76EE\u6807\u6C49\u5B57\uFF1A",(0,a.jsx)("span",{className:"character",children:x})]})]})}var de=v(76277);function ve(){var A=(0,u.useState)(3),x=m()(A,2),C=x[0],L=x[1],V=(0,u.useState)(1),M=m()(V,2),y=M[0],K=M[1],R=(0,u.useState)("\u6211\u662F\u4E2D\u56FD\u4EBA\u7231\u6211\u4E2D\u534E"),N=m()(R,2),p=N[0],Z=N[1],Y=(0,u.useState)([]),S=m()(Y,2),E=S[0],w=S[1],X=(0,u.useState)(null),B=m()(X,2),P=B[0],z=B[1],H=(0,u.useState)([]),d=m()(H,2),D=d[0],b=d[1],Q=(0,u.useState)(0),F=m()(Q,2),G=F[0],$=F[1],O=(0,u.useState)(""),U=m()(O,2),f=U[0],W=U[1],q=function(t){var c=800,i=t||"\u6211";return console.log("createTarget called:",{inputCharacter:t,finalText:i,timestamp:Date.now()}),{id:Date.now()+Math.random(),text:i,x:Math.random()*(c-100)+50,y:-30,speed:C*.3+.2,currentInput:"",pinyin:""}},r=function(t){if(console.log("handleCharacterMatch called:",{character:t,currentCharacter:f,targets:E.map(function(l){return{id:l.id,text:l.text}})}),t===f){var c=E.filter(function(l){return l.text===t});if(console.log("\u5339\u914D\u5230\u7684\u76EE\u6807:",c),c.length>0){c.forEach(function(l){e(l.x,l.y)}),w(function(l){var j=l.filter(function(J){return J.text!==t});return console.log("\u5269\u4F59\u76EE\u6807:",j),j}),$(function(l){return l+1}),s();var i=p.split("").filter(function(l){return l.trim()}),o=i.indexOf(f),h=(o+1)%i.length,g=i[h];console.log("\u5207\u6362\u5230\u4E0B\u4E00\u4E2A\u5B57\u7B26:",g),setTimeout(function(){W(g),w(function(l){var j=y-l.length;if(console.log("\u9700\u8981\u751F\u6210",j,"\u4E2A\u65B0\u76EE\u6807\uFF0C\u4F7F\u7528\u5B57\u7B26:",g),j>0){var J=Array.from({length:j},function(ge,he){var ee=q(g);return console.log("\u751F\u6210\u65B0\u76EE\u6807 ".concat(he,":"),ee),ee});return console.log("\u65B0\u76EE\u6807\u5217\u8868:",J),[].concat(k()(l),J)}return l})},1e3)}}},e=function(t,c){var i=Date.now()+Math.random();b(function(o){return[].concat(k()(o),[{id:i,x:t,y:c}])}),setTimeout(function(){b(function(o){return o.filter(function(h){return h.id!==i})})},3e3)},s=function(){try{var t=new(window.AudioContext||window.webkitAudioContext),c=[523,659,784,1047],i=.2;c.forEach(function(o,h){setTimeout(function(){var g=t.createOscillator(),l=t.createGain();g.connect(l),l.connect(t.destination),g.frequency.setValueAtTime(o,t.currentTime),g.type="sine",l.gain.setValueAtTime(.2,t.currentTime),l.gain.exponentialRampToValueAtTime(.01,t.currentTime+i),g.start(t.currentTime),g.stop(t.currentTime+i)},h*i*1e3)})}catch(o){console.error("\u64AD\u653E\u97F3\u6548\u5931\u8D25:",o)}};return(0,u.useEffect)(function(){if(console.log("=== \u521D\u59CB\u5316\u5F00\u59CB ===",{hanziList:p,currentCharacter:f,count:y,speed:C}),p){var n=p.split("").filter(function(o){return o.trim()});if(console.log("\u5B57\u7B26\u5217\u8868:",n),n.length>0){var t=n[0];console.log("\u8BBE\u7F6E\u7B2C\u4E00\u4E2A\u5B57\u7B26:",t),(!f||f==="")&&W(t);var c=f||t,i=Array.from({length:y},function(o,h){return{id:Date.now()+h,text:c,x:Math.random()*700+50,y:Math.random()*-200-30,speed:C*.3+.2,currentInput:"",pinyin:""}});console.log("\u751F\u6210\u521D\u59CB\u76EE\u6807:",i.length,"\u4E2A\u76EE\u6807\uFF0C\u5B57\u7B26:",c),w(i),console.log("=== \u521D\u59CB\u5316\u5B8C\u6210 ===")}}},[p,f,y,C]),(0,u.useEffect)(function(){var n=setInterval(function(){w(function(t){var c=t.map(function(o){var h=o.y+o.speed;return h>600?I()(I()({},o),{},{y:-30}):I()(I()({},o),{},{y:h})}),i=c.filter(function(o,h){return o.text!==t[h].text});return i.length>0&&console.log("\u8B66\u544A\uFF1A\u76EE\u6807\u5B57\u7B26\u88AB\u4FEE\u6539\uFF01",i),c})},50);return function(){return clearInterval(n)}},[]),(0,u.useEffect)(function(){if(E.length>0&&f){var n=E.find(function(t){return t.text===f});n&&z(n)}else console.log("\u6CA1\u6709\u5339\u914D\u76EE\u6807\u6216\u6CA1\u6709\u5F53\u524D\u5B57\u7B26"),z(null)},[E,f]),(0,a.jsxs)("div",{className:"level-page",children:[(0,a.jsxs)("div",{className:"game-area",children:[(0,a.jsxs)("div",{className:"level-header level-4",children:[(0,a.jsx)("h2",{children:"\u7B2C\u56DB\u5173\uFF1A\u624B\u5199\u6311\u6218"}),(0,a.jsx)("p",{children:"\u5728\u624B\u5199\u533A\u57DF\u5199\u51FA\u76EE\u6807\u6C49\u5B57\u6765\u51FB\u843D\u5B83\u4EEC"}),(0,a.jsxs)("div",{className:"success-counter",children:["\u6210\u529F\u51FB\u843D\uFF1A",G," \u4E2A"]})]}),(0,a.jsx)(ue.Z,{level:3,speed:C,maxCount:y,customList:p,handwritingMode:!0,currentTarget:P,explosions:D})]}),(0,a.jsxs)("div",{className:"config-area",children:[(0,a.jsxs)("div",{className:"config-panel",children:[(0,a.jsx)("h3",{children:"\u6E38\u620F\u8BBE\u7F6E"}),(0,a.jsxs)("div",{className:"config-section",children:[(0,a.jsx)("label",{children:"\u6389\u843D\u901F\u5EA6"}),(0,a.jsx)("input",{type:"range",min:"1",max:"10",value:C,onChange:function(t){return L(Number(t.target.value))},className:"slider"}),(0,a.jsx)("div",{className:"value-display",children:C})]}),(0,a.jsxs)("div",{className:"config-section",children:[(0,a.jsx)("label",{children:"\u6C49\u5B57\u5217\u8868"}),(0,a.jsx)("textarea",{value:p,onChange:function(t){return Z(t.target.value)},placeholder:"\u4F8B\u5982: \u6211\u662F\u4E2D\u56FD\u4EBA\u7231\u6211\u4E2D\u534E",rows:4,className:"list-input"}),(0,a.jsx)("div",{className:"hint",children:"\u4FEE\u6539\u540E\u7ACB\u5373\u751F\u6548"})]}),(0,a.jsxs)("div",{className:"handwriting-section",children:[(0,a.jsx)("h4",{children:"\u624B\u5199\u533A\u57DF"}),(0,a.jsx)("div",{className:"current-targets",children:f?(0,a.jsxs)("div",{className:"target-list",children:[(0,a.jsx)("p",{className:"target-instruction",children:"\u5F53\u524D\u7EC3\u4E60\u6C49\u5B57\uFF1A"}),(0,a.jsx)("div",{className:"target-characters",children:(0,a.jsx)("span",{className:"target-char active",children:f})}),(0,a.jsx)("p",{className:"target-hint",children:"\u5199\u51FA\u8FD9\u4E2A\u6C49\u5B57\u6765\u51FB\u843D\u6240\u6709\u76F8\u540C\u7684\u76EE\u6807"})]}):(0,a.jsx)("p",{className:"no-targets",children:"\u8BF7\u8BBE\u7F6E\u6C49\u5B57\u5217\u8868"})}),(0,a.jsx)(le,{targetCharacter:f,onCharacterMatch:r,width:280,height:280})]})]}),(0,a.jsx)("button",{className:"back-btn",onClick:function(){return re.m8.push("/")},children:"\u8FD4\u56DE\u9996\u9875"})]})]})}}}]);
