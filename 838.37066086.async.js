"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[838],{98320:function(je,de,p){p.d(de,{Z:function(){return Te}});var ve=p(74704),he=p.n(ve),ye=p(42122),h=p.n(ye),pe=p(17061),X=p.n(pe),ge=p(17156),me=p.n(ge),we=p(861),L=p.n(we),Se=p(27424),E=p.n(Se),s=p(67294),xe=p(91845),Y=p(85893);function Te(S){var c=S.level,C=S.speed,z=S.maxCount,B=S.customList,x=B===void 0?"":B,W=S.charType,m=W===void 0?"mixed":W,O=S.handwritingMode,P=O===void 0?!1:O,Z=S.currentTarget,A=Z===void 0?null:Z,K=S.explosions,U=K===void 0?[]:K,D=S.showPinyin,Ie=D===void 0?!1:D,T=(0,s.useRef)(null),be=(0,s.useState)([]),J=E()(be,2),M=J[0],k=J[1],Ce=(0,s.useState)([]),Q=E()(Ce,2),q=Q[0],F=Q[1],Pe=(0,s.useState)([]),_=E()(Pe,2),ee=_[0],$=_[1],Me=(0,s.useState)(null),ne=E()(Me,2),w=ne[0],I=ne[1],te=(0,s.useRef)(0),ke=(0,s.useRef)(0),Re=(0,s.useRef)(0),j=(0,s.useRef)(),G=(0,s.useRef)(0),R=(0,s.useRef)(0),re={\u00FC:"\u9C7C",a:"\u554A",b:"\u6CE2",c:"\u96CC",d:"\u5F97",e:"\u9E45",f:"\u4F5B",g:"\u54E5",h:"\u559D",i:"\u8863",j:"\u57FA",k:"\u79D1",l:"\u52D2",m:"\u6478",n:"\u8BB7",o:"\u5594",p:"\u5761",q:"\u6B3A",r:"\u65E5",s:"\u601D",t:"\u7279",u:"\u4E4C",w:"\u5DEB",x:"\u5E0C",y:"\u8863",z:"\u8D44",sh:"\u601D",ch:"\u86A9",ai:"\u54C0",ei:"\u8BF6",ui:"\u5A01",ao:"\u71AC",ou:"\u6B27",iu:"\u4F18",ie:"\u8036",\u00FCe:"\u7EA6",er:"\u8033",an:"\u5B89",en:"\u6069",in:"\u56E0",un:"\u6E29",\u00FCn:"\u4E91",ang:"\u6602",eng:"\u97A5",ing:"\u82F1",ong:"\u7FC1",zhi:"\u77E5",chi:"\u5403",ri:"\u65E5",zi:"\u8D44",ci:"\u523A",si:"\u4E1D",wu:"\u5C4B",shi:"\u72EE",yi:"\u8863",yu:"\u9C7C",ye:"\u8036",yue:"\u6708",yuan:"\u5143",yin:"\u56E0",yun:"\u4E91",ying:"\u9E70"},H=Object.keys(re),ie=(0,s.useCallback)(function(){return c===1?m==="letter"?"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""):m==="pinying"?H:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".split(""):c===2?x.trim()?x.split(",").map(function(t){return t.trim()}).filter(function(t){return t}):H:x.trim()?x.split("").filter(function(t){return t.trim()}):"\u6211\u662F\u4E2D\u56FD\u4EBA".split("")},[c,x,m]),Ee=function(n){var r,e=(0,xe.N9)(n,{toneType:"none",type:"array"});return((r=e[0])===null||r===void 0?void 0:r.toLowerCase())||"unknown"},ae=(0,s.useCallback)(function(){var t=T.current;if(!t)return{id:0,text:"",x:0,y:0,speed:0,currentInput:""};var n=ie(),r=n[Math.floor(Math.random()*n.length)];return{id:te.current++,text:r,x:Math.random()*(t.width-100)+50,y:-30,speed:C*.3+.2,currentInput:"",pinyin:c===3?Ee(r):void 0}},[c,C,ie]),ue=function(n,r,e){var a=T.current;if(a){F(function(u){return[].concat(L()(u),[{id:ke.current++,x:R.current,y:a.height-50,targetX:r,targetY:e,targetId:n,speed:40}])});try{var i=new(window.AudioContext||window.webkitAudioContext),l=i.createOscillator(),o=i.createGain();l.connect(o),o.connect(i.destination),l.frequency.value=1200,l.type="sine",o.gain.setValueAtTime(.08,i.currentTime),o.gain.exponentialRampToValueAtTime(.01,i.currentTime+.04),l.start(),l.stop(i.currentTime+.04)}catch(u){}}},Ae=function(n,r){for(var e=[],a=0;a<80;a++){var i=Math.PI*2*a/80,l=2+Math.random()*7;e.push({id:Re.current++,x:n,y:r,vx:Math.cos(i)*l,vy:Math.sin(i)*l,life:1,size:2+Math.random()*4})}$(function(g){return[].concat(L()(g),e)});try{var o=new(window.AudioContext||window.webkitAudioContext),u=o.createOscillator(),y=o.createGain();u.connect(y),y.connect(o.destination),u.frequency.value=120,u.type="sawtooth",y.gain.setValueAtTime(.15,o.currentTime),y.gain.exponentialRampToValueAtTime(.01,o.currentTime+.35),u.start(),u.stop(o.currentTime+.35)}catch(g){}},Le=function(n){console.log("Playing pinyin sound for:",n);var r=re[n];if(r){var e=new SpeechSynthesisUtterance(r);e.lang="zh-CN",e.rate=.8,window.speechSynthesis.speak(e)}},ze=function(n){if(window.speechSynthesis){console.log("Playing letter sound for:",m);var r=/^[a-zA-Z]$/.test(n)&&m!=="pinying",e=H.includes(n),a=/[0-9]/.test(n);if(r){console.log("Playing letter sound for:",n);var i=new SpeechSynthesisUtterance(n);i.lang="en-US",i.rate=.85,i.pitch=1,i.volume=1;var l=function(){var v=window.speechSynthesis.getVoices(),b=v.find(function(f){return f.name.includes("Google US English")})||v.find(function(f){return f.lang==="en-US"&&f.name.includes("Female")})||v.find(function(f){return f.lang==="en-US"&&f.localService})||v.find(function(f){return f.lang==="en-US"})||v.find(function(f){return f.lang.startsWith("en")});b&&(i.voice=b,console.log("Using voice:",b.name)),window.speechSynthesis.speak(i)},o=window.speechSynthesis.getVoices();o.length>0?l():window.speechSynthesis.onvoiceschanged=function(){l(),window.speechSynthesis.onvoiceschanged=null}}else if(e)console.log("Playing pinyin sound for:",n),Le(n);else if(a){var u={0:"\u96F6",1:"\u4E00",2:"\u4E8C",3:"\u4E09",4:"\u56DB",5:"\u4E94",6:"\u516D",7:"\u4E03",8:"\u516B",9:"\u4E5D"},y=u[n];if(y){var g=new SpeechSynthesisUtterance(y);g.lang="zh-CN",g.rate=.85,window.speechSynthesis.speak(g)}}}},Ue=function(){var t=me()(X()().mark(function n(r){var e,a,i,l;return X()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:e=1;case 1:if(!(e<=4)){u.next=19;break}return u.prev=2,a=(window.routerBase||"/").replace(/\/$/,""),i="".concat(a,"/mp3/").concat(r).concat(e,".mp3"),l=new Audio(i),u.next=8,l.play();case 8:return u.next=10,new Promise(function(y){return setTimeout(y,1e3)});case 10:u.next=16;break;case 12:return u.prev=12,u.t0=u.catch(2),console.error("Failed to play ".concat(r).concat(e,":"),u.t0),u.abrupt("break",19);case 16:e++,u.next=1;break;case 19:case"end":return u.stop()}},n,null,[[2,12]])}));return function(r){return t.apply(this,arguments)}}(),Fe=function(n){if(window.speechSynthesis){var r=new SpeechSynthesisUtterance(n);r.lang="zh-CN",r.rate=.8,window.speechSynthesis.speak(r)}},le=(0,s.useCallback)(function(t,n){var r=R.current,e=n.height-40;t.fillStyle="#22c55e",t.beginPath(),t.moveTo(r,e-15),t.lineTo(r-12,e+8),t.lineTo(r+12,e+8),t.closePath(),t.fill(),t.strokeStyle="#16a34a",t.lineWidth=2,t.stroke()},[]),oe=(0,s.useCallback)(function(t){q.forEach(function(n){var r=n.targetX-n.x,e=n.targetY-n.y,a=Math.sqrt(r*r+e*e),i=Math.min(40,a);if(a>0){var l=n.x+r/a*i,o=n.y+e/a*i;t.strokeStyle="rgba(255, 255, 255, 0.95)",t.lineWidth=2.5,t.lineCap="round",t.beginPath(),t.moveTo(n.x,n.y),t.lineTo(l,o),t.stroke()}t.fillStyle="#fff",t.beginPath(),t.arc(n.x,n.y,3,0,Math.PI*2),t.fill()})},[q]),se=(0,s.useCallback)(function(t){ee.forEach(function(n){var r=n.life,e=255,a,i;r>.7?(a=255,i=200+(1-r)*55):r>.4?(a=200-(.7-r)*200,i=100):(a=140-(.4-r)*140,i=50),t.globalAlpha=r,t.fillStyle="rgb(".concat(e,",").concat(a,",").concat(i,")"),t.beginPath(),t.arc(n.x,n.y,n.size,0,Math.PI*2),t.fill()}),t.globalAlpha=1},[ee]),$e=(0,s.useCallback)(function(t){P&&U.forEach(function(n){for(var r=30,e=n.x,a=n.y,i=0;i<r;i++){var l=Math.PI*2*i/r,o=Math.random()*50,u=e+Math.cos(l)*o,y=a+Math.sin(l)*o,g=["#ff6b6b","#4ecdc4","#45b7d1","#f9ca24","#f0932b"];t.fillStyle=g[Math.floor(Math.random()*g.length)],t.beginPath(),t.arc(u,y,Math.random()*4+2,0,Math.PI*2),t.fill()}var d=t.createRadialGradient(e,a,0,e,a,30);d.addColorStop(0,"rgba(255, 255, 255, 0.8)"),d.addColorStop(1,"rgba(255, 255, 255, 0)"),t.fillStyle=d,t.beginPath(),t.arc(e,a,30,0,Math.PI*2),t.fill()})},[P,U]),fe=(0,s.useCallback)(function(){var t=T.current,n=t==null?void 0:t.getContext("2d");if(!(!t||!n)){n.fillStyle="#0f172a",n.fillRect(0,0,t.width,t.height),n.fillStyle="rgba(255,255,255,0.3)";for(var r=0;r<80;r++)n.beginPath(),n.arc(r*137.5%t.width,r*197.3%t.height,.8,0,Math.PI*2),n.fill();se(n),M.forEach(function(e){var a=P?(A==null?void 0:A.id)===e.id:w===e.id;if(n.font=c===1?"bold 28px monospace":"bold 24px monospace",n.textAlign="center",n.textBaseline="middle",P)n.fillStyle=a?"#fbbf24":"#e2e8f0",n.fillText(e.text,e.x,e.y),a&&(n.strokeStyle="#fbbf24",n.lineWidth=3,n.strokeRect(e.x-30,e.y-30,60,60));else if(c===3)n.fillStyle=a?"#fbbf24":"#e2e8f0",n.fillText(e.text,e.x,e.y),e.currentInput&&(n.font="bold 48px monospace",n.fillStyle="#10b981",n.fillText(e.currentInput,e.x,e.y+50)),Ie&&e.pinyin&&e.pinyin.length>e.currentInput.length&&(n.font="bold 48px monospace",n.fillStyle="#64748b",n.fillText(e.pinyin.substring(e.currentInput.length),e.x+e.currentInput.length*28,e.y+50));else if(c===2){var i=e.currentInput.length;i>0&&(n.fillStyle="#10b981",n.fillText(e.text.substring(0,i),e.x-(e.text.length-i)*9,e.y)),i<e.text.length&&(n.fillStyle=a?"#fbbf24":"#e2e8f0",n.fillText(e.text.substring(i),e.x+i*9,e.y))}else{var l=w===e.id;if(m==="pinying"&&e.currentInput){n.fillStyle="#10b981";var o=e.currentInput.length*16;n.fillText(e.currentInput,e.x-(e.text.length-e.currentInput.length)*8,e.y),e.currentInput.length<e.text.length&&(n.fillStyle=l?"#fbbf24":"#e2e8f0",n.fillText(e.text.substring(e.currentInput.length),e.x+e.currentInput.length*8,e.y))}else n.fillStyle=l?"#fbbf24":"#e2e8f0",n.fillText(e.text,e.x,e.y)}}),oe(n),le(n,t),$e(n)}},[M,w,c,le,oe,se,P,A,U]),ce=(0,s.useCallback)(function(){var t=T.current;if(t&&(k(function(r){return r.map(function(e){var a=e.y+e.speed;return a>t.height+30?(w===e.id&&I(null),h()(h()({},e),{},{y:-30,x:Math.random()*(t.width-100)+50,currentInput:""})):h()(h()({},e),{},{y:a})})}),F(function(r){var e=[];return r.forEach(function(a){var i=M.find(function(d){return d.id===a.targetId});if(i){a.targetX=i.x,a.targetY=i.y;var l=a.targetX-a.x,o=a.targetY-a.y,u=Math.sqrt(l*l+o*o);if(u<20){var y=c===3?i.pinyin:i.text;if(console.log("Expected:",i,y,i.currentInput.length,y.length),i.currentInput.length===y.length){Ae(a.targetX,a.targetY),c===1?setTimeout(function(){return ze(i.text)},100):c===2?setTimeout(function(){return Ue(i.text)},100):c===3&&setTimeout(function(){return Fe(i.text)},100),k(function(d){return d.filter(function(v){return v.id!==a.targetId})});return}else return}var g=a.speed/u;e.push(h()(h()({},a),{},{x:a.x+l*g,y:a.y+o*g}))}}),e}),$(function(r){return r.map(function(e){return h()(h()({},e),{},{x:e.x+e.vx,y:e.y+e.vy,vy:e.vy+.08,vx:e.vx*.98,life:e.life-.018})}).filter(function(e){return e.life>0})}),w!==null)){var n=M.find(function(r){return r.id===w});n&&(R.current+=(n.x-R.current)*.15)}},[w,M,c]),N=(0,s.useCallback)(function(t){t-G.current>=1e3/30&&(ce(),G.current=t),fe(),j.current=requestAnimationFrame(N)},[ce,fe]),V=(0,s.useCallback)(function(t){var n=t.key.toLowerCase();n.length===1&&(n==="v"&&(c===2||c===3||c===1&&m==="pinying")&&(n="\xFC"),k(function(r){if(w!==null){var e=r.find(function(d){return d.id===w});if(e){var a=c===3?e.pinyin:e.text,i=a[e.currentInput.length];if(i&&n===i.toLowerCase()){ue(e.id,e.x,e.y);var l=e.currentInput+n;return l.length,a.length,r.map(function(d){return d.id===e.id?h()(h()({},d),{},{currentInput:l}):d})}else return I(null),r.map(function(d){return d.id===e.id?h()(h()({},d),{},{currentInput:""}):d})}}var o=he()(r),u;try{var y=function(){var v=u.value,b=c===3?v.pinyin:v.text;if(n===b[0].toLowerCase())return ue(v.id,v.x,v.y),c===1?m==="pinying"?(I(v.id),{v:r.map(function(f){return f.id===v.id?h()(h()({},f),{},{currentInput:n}):f})}):(I(v.id),{v:r.map(function(f){return f.id===v.id?h()(h()({},f),{},{currentInput:b}):f})}):(I(v.id),{v:r.map(function(f){return f.id===v.id?h()(h()({},f),{},{currentInput:n}):f})})},g;for(o.s();!(u=o.n()).done;)if(g=y(),g)return g.v}catch(d){o.e(d)}finally{o.f()}return r}))},[w,c,m]);return(0,s.useEffect)(function(){var t=T.current;if(t){var n=function(){var e=t.parentElement;e&&(t.width=e.clientWidth,t.height=e.clientHeight,R.current=t.width/2)};return n(),window.addEventListener("resize",n),function(){return window.removeEventListener("resize",n)}}},[]),(0,s.useEffect)(function(){var t=setInterval(function(){k(function(n){return n.length<z?[].concat(L()(n),[ae()]):n})},2e3/C);return function(){return clearInterval(t)}},[z,C,ae]),(0,s.useEffect)(function(){return G.current=performance.now(),N(performance.now()),function(){j.current&&cancelAnimationFrame(j.current)}},[N]),(0,s.useEffect)(function(){return window.addEventListener("keydown",V),function(){return window.removeEventListener("keydown",V)}},[V]),(0,s.useEffect)(function(){k([]),I(null),F([]),$([]),te.current=0},[m,C,z,x]),(0,Y.jsx)("div",{className:"game-canvas-container",children:(0,Y.jsx)("canvas",{ref:T,className:"game-canvas"})})}},76277:function(){}}]);
