(self.webpackChunk=self.webpackChunk||[]).push([[628],{98320:function(a,S,u){"use strict";u.d(S,{Z:function(){return Te}});var g=u(74704),v=u.n(g),l=u(42122),f=u.n(l),y=u(17061),b=u.n(y),A=u(17156),k=u.n(A),z=u(861),R=u.n(z),L=u(27424),C=u.n(L),p=u(67294),be=u(91845),_=u(85893);function Te(E){var x=E.level,O=E.speed,X=E.maxCount,ee=E.customList,j=ee===void 0?"":ee,ne=E.charType,M=ne===void 0?"mixed":ne,te=E.handwritingMode,W=te===void 0?!1:te,re=E.currentTarget,V=re===void 0?null:re,ae=E.explosions,Y=ae===void 0?[]:ae,ie=E.showPinyin,Ie=ie===void 0?!1:ie,H=(0,p.useRef)(null),Ae=(0,p.useState)([]),oe=C()(Ae,2),$=oe[0],G=oe[1],Ce=(0,p.useState)([]),ue=C()(Ce,2),le=ue[0],B=ue[1],Me=(0,p.useState)([]),se=C()(Me,2),fe=se[0],Z=se[1],Pe=(0,p.useState)(null),ce=C()(Pe,2),P=ce[0],U=ce[1],de=(0,p.useRef)(0),ke=(0,p.useRef)(0),Ee=(0,p.useRef)(0),K=(0,p.useRef)(),D=(0,p.useRef)(0),N=(0,p.useRef)(0),pe={\u00FC:"\u9C7C",a:"\u554A",b:"\u6CE2",c:"\u96CC",d:"\u5F97",e:"\u9E45",f:"\u4F5B",g:"\u54E5",h:"\u559D",i:"\u8863",j:"\u57FA",k:"\u79D1",l:"\u52D2",m:"\u6478",n:"\u8BB7",o:"\u5594",p:"\u5761",q:"\u6B3A",r:"\u65E5",s:"\u601D",t:"\u7279",u:"\u4E4C",w:"\u5DEB",x:"\u5E0C",y:"\u8863",z:"\u8D44",sh:"\u601D",ch:"\u86A9",ai:"\u54C0",ei:"\u8BF6",ui:"\u5A01",ao:"\u71AC",ou:"\u6B27",iu:"\u4F18",ie:"\u8036",\u00FCe:"\u7EA6",er:"\u8033",an:"\u5B89",en:"\u6069",in:"\u56E0",un:"\u6E29",\u00FCn:"\u4E91",ang:"\u6602",eng:"\u97A5",ing:"\u82F1",ong:"\u7FC1",zhi:"\u77E5",chi:"\u5403",ri:"\u65E5",zi:"\u8D44",ci:"\u523A",si:"\u4E1D",wu:"\u5C4B",shi:"\u72EE",yi:"\u8863",yu:"\u9C7C",ye:"\u8036",yue:"\u6708",yuan:"\u5143",yin:"\u56E0",yun:"\u4E91",ying:"\u9E70"},J=Object.keys(pe),ve=(0,p.useCallback)(function(){return x===1?M==="letter"?"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""):M==="pinying"?J:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".split(""):x===2?j.trim()?j.split(",").map(function(t){return t.trim()}).filter(function(t){return t}):J:j.trim()?j.split("").filter(function(t){return t.trim()}):"\u6211\u662F\u4E2D\u56FD\u4EBA".split("")},[x,j,M]),Re=function(n){var r,e=(0,be.N9)(n,{toneType:"none",type:"array"});return((r=e[0])===null||r===void 0?void 0:r.toLowerCase())||"unknown"},ye=(0,p.useCallback)(function(){var t=H.current;if(!t)return{id:0,text:"",x:0,y:0,speed:0,currentInput:""};var n=ve(),r=n[Math.floor(Math.random()*n.length)];return{id:de.current++,text:r,x:Math.random()*(t.width-100)+50,y:-30,speed:O*.3+.2,currentInput:"",pinyin:x===3?Re(r):void 0}},[x,O,ve]),he=function(n,r,e){var o=H.current;if(o){B(function(s){return[].concat(R()(s),[{id:ke.current++,x:N.current,y:o.height-50,targetX:r,targetY:e,targetId:n,speed:40}])});try{var i=new(window.AudioContext||window.webkitAudioContext),c=i.createOscillator(),d=i.createGain();c.connect(d),d.connect(i.destination),c.frequency.value=1200,c.type="sine",d.gain.setValueAtTime(.08,i.currentTime),d.gain.exponentialRampToValueAtTime(.01,i.currentTime+.04),c.start(),c.stop(i.currentTime+.04)}catch(s){}}},Le=function(n,r){for(var e=[],o=0;o<80;o++){var i=Math.PI*2*o/80,c=2+Math.random()*7;e.push({id:Ee.current++,x:n,y:r,vx:Math.cos(i)*c,vy:Math.sin(i)*c,life:1,size:2+Math.random()*4})}Z(function(I){return[].concat(R()(I),e)});try{var d=new(window.AudioContext||window.webkitAudioContext),s=d.createOscillator(),T=d.createGain();s.connect(T),T.connect(d.destination),s.frequency.value=120,s.type="sawtooth",T.gain.setValueAtTime(.15,d.currentTime),T.gain.exponentialRampToValueAtTime(.01,d.currentTime+.35),s.start(),s.stop(d.currentTime+.35)}catch(I){}},ze=function(n){console.log("Playing pinyin sound for:",n);var r=pe[n];if(r){var e=new SpeechSynthesisUtterance(r);e.lang="zh-CN",e.rate=.8,window.speechSynthesis.speak(e)}},je=function(n){if(window.speechSynthesis){console.log("Playing letter sound for:",M);var r=/^[a-zA-Z]$/.test(n)&&M!=="pinying",e=J.includes(n),o=/[0-9]/.test(n);if(r){console.log("Playing letter sound for:",n);var i=new SpeechSynthesisUtterance(n);i.lang="en-US",i.rate=.85,i.pitch=1,i.volume=1;var c=function(){var w=window.speechSynthesis.getVoices(),F=w.find(function(h){return h.name.includes("Google US English")})||w.find(function(h){return h.lang==="en-US"&&h.name.includes("Female")})||w.find(function(h){return h.lang==="en-US"&&h.localService})||w.find(function(h){return h.lang==="en-US"})||w.find(function(h){return h.lang.startsWith("en")});F&&(i.voice=F,console.log("Using voice:",F.name)),window.speechSynthesis.speak(i)},d=window.speechSynthesis.getVoices();d.length>0?c():window.speechSynthesis.onvoiceschanged=function(){c(),window.speechSynthesis.onvoiceschanged=null}}else if(e)console.log("Playing pinyin sound for:",n),ze(n);else if(o){var s={0:"\u96F6",1:"\u4E00",2:"\u4E8C",3:"\u4E09",4:"\u56DB",5:"\u4E94",6:"\u516D",7:"\u4E03",8:"\u516B",9:"\u4E5D"},T=s[n];if(T){var I=new SpeechSynthesisUtterance(T);I.lang="zh-CN",I.rate=.85,window.speechSynthesis.speak(I)}}}},He=function(){var t=k()(b()().mark(function n(r){var e,o,i,c;return b()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:e=1;case 1:if(!(e<=4)){s.next=19;break}return s.prev=2,o=(window.routerBase||"/").replace(/\/$/,""),i="".concat(o,"/mp3/").concat(r).concat(e,".mp3"),c=new Audio(i),s.next=8,c.play();case 8:return s.next=10,new Promise(function(T){return setTimeout(T,1e3)});case 10:s.next=16;break;case 12:return s.prev=12,s.t0=s.catch(2),console.error("Failed to play ".concat(r).concat(e,":"),s.t0),s.abrupt("break",19);case 16:e++,s.next=1;break;case 19:case"end":return s.stop()}},n,null,[[2,12]])}));return function(r){return t.apply(this,arguments)}}(),Ue=function(n){if(window.speechSynthesis){var r=new SpeechSynthesisUtterance(n);r.lang="zh-CN",r.rate=.8,window.speechSynthesis.speak(r)}},ge=(0,p.useCallback)(function(t,n){var r=N.current,e=n.height-40;t.fillStyle="#22c55e",t.beginPath(),t.moveTo(r,e-15),t.lineTo(r-12,e+8),t.lineTo(r+12,e+8),t.closePath(),t.fill(),t.strokeStyle="#16a34a",t.lineWidth=2,t.stroke()},[]),xe=(0,p.useCallback)(function(t){le.forEach(function(n){var r=n.targetX-n.x,e=n.targetY-n.y,o=Math.sqrt(r*r+e*e),i=Math.min(40,o);if(o>0){var c=n.x+r/o*i,d=n.y+e/o*i;t.strokeStyle="rgba(255, 255, 255, 0.95)",t.lineWidth=2.5,t.lineCap="round",t.beginPath(),t.moveTo(n.x,n.y),t.lineTo(c,d),t.stroke()}t.fillStyle="#fff",t.beginPath(),t.arc(n.x,n.y,3,0,Math.PI*2),t.fill()})},[le]),me=(0,p.useCallback)(function(t){fe.forEach(function(n){var r=n.life,e=255,o,i;r>.7?(o=255,i=200+(1-r)*55):r>.4?(o=200-(.7-r)*200,i=100):(o=140-(.4-r)*140,i=50),t.globalAlpha=r,t.fillStyle="rgb(".concat(e,",").concat(o,",").concat(i,")"),t.beginPath(),t.arc(n.x,n.y,n.size,0,Math.PI*2),t.fill()}),t.globalAlpha=1},[fe]),Fe=(0,p.useCallback)(function(t){W&&Y.forEach(function(n){for(var r=30,e=n.x,o=n.y,i=0;i<r;i++){var c=Math.PI*2*i/r,d=Math.random()*50,s=e+Math.cos(c)*d,T=o+Math.sin(c)*d,I=["#ff6b6b","#4ecdc4","#45b7d1","#f9ca24","#f0932b"];t.fillStyle=I[Math.floor(Math.random()*I.length)],t.beginPath(),t.arc(s,T,Math.random()*4+2,0,Math.PI*2),t.fill()}var m=t.createRadialGradient(e,o,0,e,o,30);m.addColorStop(0,"rgba(255, 255, 255, 0.8)"),m.addColorStop(1,"rgba(255, 255, 255, 0)"),t.fillStyle=m,t.beginPath(),t.arc(e,o,30,0,Math.PI*2),t.fill()})},[W,Y]),we=(0,p.useCallback)(function(){var t=H.current,n=t==null?void 0:t.getContext("2d");if(!(!t||!n)){n.fillStyle="#0f172a",n.fillRect(0,0,t.width,t.height),n.fillStyle="rgba(255,255,255,0.3)";for(var r=0;r<80;r++)n.beginPath(),n.arc(r*137.5%t.width,r*197.3%t.height,.8,0,Math.PI*2),n.fill();me(n),$.forEach(function(e){var o=W?(V==null?void 0:V.id)===e.id:P===e.id;if(n.font=x===1?"bold 28px monospace":"bold 24px monospace",n.textAlign="center",n.textBaseline="middle",W)n.fillStyle=o?"#fbbf24":"#e2e8f0",n.fillText(e.text,e.x,e.y),o&&(n.strokeStyle="#fbbf24",n.lineWidth=3,n.strokeRect(e.x-30,e.y-30,60,60));else if(x===3)n.fillStyle=o?"#fbbf24":"#e2e8f0",n.fillText(e.text,e.x,e.y),e.currentInput&&(n.font="bold 48px monospace",n.fillStyle="#10b981",n.fillText(e.currentInput,e.x,e.y+50)),Ie&&e.pinyin&&e.pinyin.length>e.currentInput.length&&(n.font="bold 48px monospace",n.fillStyle="#64748b",n.fillText(e.pinyin.substring(e.currentInput.length),e.x+e.currentInput.length*28,e.y+50));else if(x===2){var i=e.currentInput.length;i>0&&(n.fillStyle="#10b981",n.fillText(e.text.substring(0,i),e.x-(e.text.length-i)*9,e.y)),i<e.text.length&&(n.fillStyle=o?"#fbbf24":"#e2e8f0",n.fillText(e.text.substring(i),e.x+i*9,e.y))}else{var c=P===e.id;if(M==="pinying"&&e.currentInput){n.fillStyle="#10b981";var d=e.currentInput.length*16;n.fillText(e.currentInput,e.x-(e.text.length-e.currentInput.length)*8,e.y),e.currentInput.length<e.text.length&&(n.fillStyle=c?"#fbbf24":"#e2e8f0",n.fillText(e.text.substring(e.currentInput.length),e.x+e.currentInput.length*8,e.y))}else n.fillStyle=c?"#fbbf24":"#e2e8f0",n.fillText(e.text,e.x,e.y)}}),xe(n),ge(n,t),Fe(n)}},[$,P,x,ge,xe,me,W,V,Y]),Se=(0,p.useCallback)(function(){var t=H.current;if(t&&(G(function(r){return r.map(function(e){var o=e.y+e.speed;return o>t.height+30?(P===e.id&&U(null),f()(f()({},e),{},{y:-30,x:Math.random()*(t.width-100)+50,currentInput:""})):f()(f()({},e),{},{y:o})})}),B(function(r){var e=[];return r.forEach(function(o){var i=$.find(function(m){return m.id===o.targetId});if(i){o.targetX=i.x,o.targetY=i.y;var c=o.targetX-o.x,d=o.targetY-o.y,s=Math.sqrt(c*c+d*d);if(s<20){var T=x===3?i.pinyin:i.text;if(console.log("Expected:",i,T,i.currentInput.length,T.length),i.currentInput.length===T.length){Le(o.targetX,o.targetY),x===1?setTimeout(function(){return je(i.text)},100):x===2?setTimeout(function(){return He(i.text)},100):x===3&&setTimeout(function(){return Ue(i.text)},100),G(function(m){return m.filter(function(w){return w.id!==o.targetId})});return}else return}var I=o.speed/s;e.push(f()(f()({},o),{},{x:o.x+c*I,y:o.y+d*I}))}}),e}),Z(function(r){return r.map(function(e){return f()(f()({},e),{},{x:e.x+e.vx,y:e.y+e.vy,vy:e.vy+.08,vx:e.vx*.98,life:e.life-.018})}).filter(function(e){return e.life>0})}),P!==null)){var n=$.find(function(r){return r.id===P});n&&(N.current+=(n.x-N.current)*.15)}},[P,$,x]),Q=(0,p.useCallback)(function(t){t-D.current>=1e3/30&&(Se(),D.current=t),we(),K.current=requestAnimationFrame(Q)},[Se,we]),q=(0,p.useCallback)(function(t){var n=t.key.toLowerCase();n.length===1&&(n==="v"&&(x===2||x===3||x===1&&M==="pinying")&&(n="\xFC"),G(function(r){if(P!==null){var e=r.find(function(m){return m.id===P});if(e){var o=x===3?e.pinyin:e.text,i=o[e.currentInput.length];if(i&&n===i.toLowerCase()){he(e.id,e.x,e.y);var c=e.currentInput+n;return c.length,o.length,r.map(function(m){return m.id===e.id?f()(f()({},m),{},{currentInput:c}):m})}else return U(null),r.map(function(m){return m.id===e.id?f()(f()({},m),{},{currentInput:""}):m})}}var d=v()(r),s;try{var T=function(){var w=s.value,F=x===3?w.pinyin:w.text;if(n===F[0].toLowerCase())return he(w.id,w.x,w.y),x===1?M==="pinying"?(U(w.id),{v:r.map(function(h){return h.id===w.id?f()(f()({},h),{},{currentInput:n}):h})}):(U(w.id),{v:r.map(function(h){return h.id===w.id?f()(f()({},h),{},{currentInput:F}):h})}):(U(w.id),{v:r.map(function(h){return h.id===w.id?f()(f()({},h),{},{currentInput:n}):h})})},I;for(d.s();!(s=d.n()).done;)if(I=T(),I)return I.v}catch(m){d.e(m)}finally{d.f()}return r}))},[P,x,M]);return(0,p.useEffect)(function(){var t=H.current;if(t){var n=function(){var e=t.parentElement;e&&(t.width=e.clientWidth,t.height=e.clientHeight,N.current=t.width/2)};return n(),window.addEventListener("resize",n),function(){return window.removeEventListener("resize",n)}}},[]),(0,p.useEffect)(function(){var t=setInterval(function(){G(function(n){return n.length<X?[].concat(R()(n),[ye()]):n})},2e3/O);return function(){return clearInterval(t)}},[X,O,ye]),(0,p.useEffect)(function(){return D.current=performance.now(),Q(performance.now()),function(){K.current&&cancelAnimationFrame(K.current)}},[Q]),(0,p.useEffect)(function(){return window.addEventListener("keydown",q),function(){return window.removeEventListener("keydown",q)}},[q]),(0,p.useEffect)(function(){G([]),U(null),B([]),Z([]),de.current=0},[M,O,X,j]),(0,_.jsx)("div",{className:"game-canvas-container",children:(0,_.jsx)("canvas",{ref:H,className:"game-canvas"})})}},76277:function(){"use strict"},73897:function(a){function S(u,g){(g==null||g>u.length)&&(g=u.length);for(var v=0,l=new Array(g);v<g;v++)l[v]=u[v];return l}a.exports=S,a.exports.__esModule=!0,a.exports.default=a.exports},85372:function(a){function S(u){if(Array.isArray(u))return u}a.exports=S,a.exports.__esModule=!0,a.exports.default=a.exports},63405:function(a,S,u){var g=u(73897);function v(l){if(Array.isArray(l))return g(l)}a.exports=v,a.exports.__esModule=!0,a.exports.default=a.exports},74704:function(a,S,u){var g=u(86116);function v(l,f){var y=typeof Symbol!="undefined"&&l[Symbol.iterator]||l["@@iterator"];if(!y){if(Array.isArray(l)||(y=g(l))||f&&l&&typeof l.length=="number"){y&&(l=y);var b=0,A=function(){};return{s:A,n:function(){return b>=l.length?{done:!0}:{done:!1,value:l[b++]}},e:function(C){throw C},f:A}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var k=!0,z=!1,R;return{s:function(){y=y.call(l)},n:function(){var C=y.next();return k=C.done,C},e:function(C){z=!0,R=C},f:function(){try{!k&&y.return!=null&&y.return()}finally{if(z)throw R}}}}a.exports=v,a.exports.__esModule=!0,a.exports.default=a.exports},79498:function(a){function S(u){if(typeof Symbol!="undefined"&&u[Symbol.iterator]!=null||u["@@iterator"]!=null)return Array.from(u)}a.exports=S,a.exports.__esModule=!0,a.exports.default=a.exports},68872:function(a){function S(u,g){var v=u==null?null:typeof Symbol!="undefined"&&u[Symbol.iterator]||u["@@iterator"];if(v!=null){var l,f,y,b,A=[],k=!0,z=!1;try{if(y=(v=v.call(u)).next,g===0){if(Object(v)!==v)return;k=!1}else for(;!(k=(l=y.call(v)).done)&&(A.push(l.value),A.length!==g);k=!0);}catch(R){z=!0,f=R}finally{try{if(!k&&v.return!=null&&(b=v.return(),Object(b)!==b))return}finally{if(z)throw f}}return A}}a.exports=S,a.exports.__esModule=!0,a.exports.default=a.exports},12218:function(a){function S(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}a.exports=S,a.exports.__esModule=!0,a.exports.default=a.exports},42281:function(a){function S(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}a.exports=S,a.exports.__esModule=!0,a.exports.default=a.exports},27424:function(a,S,u){var g=u(85372),v=u(68872),l=u(86116),f=u(12218);function y(b,A){return g(b)||v(b,A)||l(b,A)||f()}a.exports=y,a.exports.__esModule=!0,a.exports.default=a.exports},861:function(a,S,u){var g=u(63405),v=u(79498),l=u(86116),f=u(42281);function y(b){return g(b)||v(b)||l(b)||f()}a.exports=y,a.exports.__esModule=!0,a.exports.default=a.exports},86116:function(a,S,u){var g=u(73897);function v(l,f){if(l){if(typeof l=="string")return g(l,f);var y=Object.prototype.toString.call(l).slice(8,-1);if(y==="Object"&&l.constructor&&(y=l.constructor.name),y==="Map"||y==="Set")return Array.from(l);if(y==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(y))return g(l,f)}}a.exports=v,a.exports.__esModule=!0,a.exports.default=a.exports}}]);
